<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request for Glass</title>
    <style>
        /* --- CSS ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --- */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f7f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .form-container {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 450px;
        }
        h2 {
            text-align: center;
            color: #333;
            margin-top: 0;
            margin-bottom: 1.5rem;
        }
        .form-group {
            margin-bottom: 1.25rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #555;
        }
        select,
        input[type="number"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 1rem;
            background-color: #fafafa;
        }
        select:disabled {
            background-color: #eee;
            cursor: not-allowed;
        }
        button {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #0056b3;
        }
        /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Loading ‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° */
        button:disabled {
            background-color: #a0a0a0;
            cursor: not-allowed;
        }
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0);
            display: none; 
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: background-color 0.4s ease;
        }
        .popup-overlay.active {
            display: flex;
            background-color: rgba(0, 0, 0, 0.6);
        }
        .popup-content {
            background: #fff;
            padding: 2.5rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            transform: translateY(-30px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            width: 90%;
            max-width: 400px;
        }
        .popup-overlay.active .popup-content {
            transform: translateY(0);
            opacity: 1;
        }
        .checkmark-container {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #4CAF50;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1.5rem;
            animation: popup-scale 0.4s ease-out forwards;
        }
        .checkmark-icon {
            width: 25px;
            height: 45px;
            border: solid white;
            border-width: 0 8px 8px 0;
            transform: rotate(45deg);
            opacity: 0;
            animation: draw-check 0.3s 0.2s ease-out forwards;
        }
        .error-container {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #f44336;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1.5rem;
            animation: popup-scale 0.4s ease-out forwards;
            color: white;
            font-size: 50px;
            font-weight: bold;
            line-height: 80px;
        }
        @keyframes popup-scale {
            0% { transform: scale(0.5); opacity: 0; }
            80% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes draw-check {
            0% { opacity: 0; height: 0; }
            100% { opacity: 1; height: 45px; }
        }
        #popup-details, #error-details {
            font-size: 1.1rem;
            color: #333;
            line-height: 1.6;
            text-align: left; 
            margin-top: 1rem;
        }
        #stock-info {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
            text-align: left;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>

    <div class="form-container">
        <h2>‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏∞‡∏à‡∏Å</h2>
        
        <button type="button" id="refresh-button" style="width: auto; padding: 5px 10px; font-size: 0.8rem; background-color: #6c757d; margin-bottom: 1rem;">üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
        
        <form id="glass-form">
            <div class="form-group">
                <label for="glass-type">‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏£‡∏∞‡∏à‡∏Å :</label>
                <select id="glass-type" name="glass_type" required>
                    <option value="">-- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•... --</option>
                </select>
            </div>
            <div class="form-group">
                <label for="thickness">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ ( ‡∏°‡∏°. ) :</label>
                <select id="thickness" name="thickness" required disabled>
                    <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏£‡∏∞‡∏à‡∏Å‡∏Å‡πà‡∏≠‡∏ô --</option>
                </select>
            </div>
            <div class="form-group">
                <label for="glass-size">‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏à‡∏Å ( ‡∏ô‡∏¥‡πâ‡∏ß ) :</label>
                <select id="glass-size" name="glass_size" required disabled>
                    <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏Å‡πà‡∏≠‡∏ô --</option>
                </select>
            </div>
            <div id="stock-info">
                ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="stock-count">N/A</span> ‡πÅ‡∏ú‡πà‡∏ô
            </div>
            <div class="form-group">
                <label for="quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ú‡πà‡∏ô:</label>
                <input type="number" id="quantity" name="quantity" min="1" value="1" required disabled>
            </div>
            <button type="submit" id="submit-button" disabled>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            <small id="form-message" style="text-align: center; display: block; margin-top: 10px; color: #888;">
                (‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á)
            </small>
        </form>
    </div>

    <div id="success-popup" class="popup-overlay">
        <div class="popup-content">
            <div class="checkmark-container">
                <div class="checkmark-icon"></div>
            </div>
            <h3>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <div id="popup-details"></div>
            <p style="font-size: 0.8rem; color: #999; margin-top: 15px;">
                ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏ô Google Sheet ‡πÅ‡∏•‡πâ‡∏ß
            </p>
        </div>
    </div>
    
    <div id="error-popup" class="popup-overlay">
        <div class="popup-content">
            <div class="error-container">!</div>
            <h3>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!</h3>
            <div id="error-details" style="text-align: center;"></div>
        </div>
    </div>


    <script>
        // --- 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏Å ---
        // !!! ‡∏ß‡∏≤‡∏á URL ‡∏Ç‡∏≠‡∏á WEB APP ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏°‡∏≤‡∏à‡∏≤‡∏Å "‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2" ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ !!!
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzJ5Aq_qAhUHvc4efXgVPlpl8zWGoBSh8mr99ln8DQ_NiMM1taHfjTXfH6JIGAhjcL4/exec'; 

        let sheetData = []; // ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ï‡πá‡∏≠‡∏Å (‡∏à‡∏∞‡∏°‡∏≤‡∏à‡∏≤‡∏Å GAS)

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Element (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
        const glassForm = document.getElementById('glass-form');
        const selectType = document.getElementById('glass-type');
        const selectThickness = document.getElementById('thickness');
        const selectSize = document.getElementById('glass-size');
        const inputQuantity = document.getElementById('quantity');
        const stockInfoDiv = document.getElementById('stock-info');
        const stockCountSpan = document.getElementById('stock-count');
        const submitButton = document.getElementById('submit-button');
        const successPopup = document.getElementById('success-popup');
        const errorPopup = document.getElementById('error-popup');
        const popupDetails = document.getElementById('popup-details');
        const errorDetails = document.getElementById('error-details');
        const refreshButton = document.getElementById('refresh-button');
        const formMessage = document.getElementById('form-message');


        // --- 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ---
        document.addEventListener('DOMContentLoaded', () => {
            if (WEB_APP_URL.includes('***')) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Web App URL ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î JavaScript ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 216 ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö');
                selectType.innerHTML = '<option value="">-- ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Web App URL --</option>';
                return;
            }
            fetchData();
        });

        refreshButton.addEventListener('click', () => {
            refreshButton.disabled = true;
            refreshButton.textContent = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï...';
            
            selectType.innerHTML = '<option value="">-- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà... --</option>';
            resetDropdown(selectThickness, '-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏£‡∏∞‡∏à‡∏Å‡∏Å‡πà‡∏≠‡∏ô --');
            resetDropdown(selectSize, '-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏Å‡πà‡∏≠‡∏ô --');
            resetStockInfo();
            
            fetchData().finally(() => {
                 refreshButton.disabled = false;
                 refreshButton.textContent = 'üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î';
            });
        });

        // --- 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Apps Script (GET) ---
        async function fetchData() {
            try {
                const response = await fetch(WEB_APP_URL);
                if (!response.ok) {
                    throw new Error(`Network response was not ok: ${response.statusText}`);
                }
                
                const result = await response.json(); // ‡πÅ‡∏õ‡∏•‡∏á JSON ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å GAS
                
                if (result.status === 'success') {
                    sheetData = result.data; 
                    populateTypeDropdown(); 
                } else {
                    throw new Error(result.message); 
                }
                
            } catch (error) {
                console.error('Error fetching data:', error);
                selectType.innerHTML = `<option value="">-- ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message} --</option>`;
            }
        }

        // --- 5. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Dropdowns ---
        function populateTypeDropdown() {
            const types = [...new Set(sheetData.map(item => item.type))];
            selectType.innerHTML = '<option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>'; 
            types.forEach(type => {
                if (type) {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    selectType.appendChild(option);
                }
            });
            selectType.disabled = false; 
        }

        selectType.addEventListener('change', () => {
            const selectedType = selectType.value;
            resetDropdown(selectThickness, '-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏Å‡πà‡∏≠‡∏ô --');
            resetDropdown(selectSize, '-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏Å‡πà‡∏≠‡∏ô --');
            resetStockInfo();
            
            if (selectedType) {
                const filteredData = sheetData.filter(item => item.type === selectedType);
                const thicknesses = [...new Set(filteredData.map(item => item.thickness))];
                selectThickness.innerHTML = '<option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>';
                
                thicknesses.sort((a, b) => {
                    const numA = parseFloat(a);
                    const numB = parseFloat(b);
                    if (!isNaN(numA) && !isNaN(numB)) {
                        return numA - numB;
                    }
                    return String(a).localeCompare(String(b));
                });

                thicknesses.forEach(thickness => {
                    if (thickness) {
                        const option = document.createElement('option');
                        option.value = thickness;
                        option.textContent = thickness;
                        selectThickness.appendChild(option);
                    }
                });
                selectThickness.disabled = false;
            }
        });

        // (‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ "‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô")
        selectThickness.addEventListener('change', () => {
            const selectedType = selectType.value;
            const selectedThickness = selectThickness.value; 
            resetDropdown(selectSize, '-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡πà‡∏≠‡∏ô --');
            resetStockInfo();

            if (selectedType && selectedThickness) {
                
                const filteredData = sheetData.filter(item => 
                    item.type === selectedType && 
                    String(item.thickness) === selectedThickness // <--- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                );
                
                const sizes = [...new Set(filteredData.map(item => item.size))];
                selectSize.innerHTML = '<option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>';
                sizes.forEach(size => {
                    if (size) {
                        const option = document.createElement('option');
                        option.value = size;
                        option.textContent = size;
                        selectSize.appendChild(option);
                    }
                });
                selectSize.disabled = false;
            }
        });
        
        selectSize.addEventListener('change', () => {
            if(selectSize.value) {
                updateStockInfo();
                inputQuantity.disabled = false;
                submitButton.disabled = false;
            } else {
                resetStockInfo();
            }
        });
        
        // --- 6. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ---
        function resetDropdown(selectElement, defaultText) {
            selectElement.innerHTML = `<option value="">${defaultText}</option>`;
            selectElement.disabled = true;
        }

        function resetStockInfo() {
            stockInfoDiv.style.display = 'none';
            stockCountSpan.textContent = 'N/A';
            inputQuantity.disabled = true;
            inputQuantity.value = '1'; 
            submitButton.disabled = true;
        }
        
        function getCurrentStock() {
            const selectedType = selectType.value;
            const selectedThickness = selectThickness.value;
            const selectedSize = selectSize.value;

            const foundItem = sheetData.find(item => 
                item.type === selectedType && 
                String(item.thickness) === selectedThickness && // <--- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                item.size === selectedSize
            );
            return foundItem ? foundItem.stock : 0;
        }

        function updateStockInfo() {
             const currentStock = getCurrentStock();
             stockCountSpan.textContent = currentStock;
             stockInfoDiv.style.display = 'block';
        }

        // --- 7. (‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ "Popup ‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô") ---
        // (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏£‡∏≠‡∏ü‡∏±‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å Server)
        glassForm.addEventListener('submit', async function(event) {
            event.preventDefault(); 

            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
            const selectedTypeVal = selectType.value;
            const selectedThicknessVal = selectThickness.value;
            const selectedSizeVal = selectSize.value;
            
            const selectedTypeText = selectType.options[selectType.selectedIndex].text;
            const selectedThicknessText = selectThickness.options[selectThickness.selectedIndex].text;
            const selectedSizeText = selectSize.options[selectSize.selectedIndex].text;
            
            const quantity = parseInt(inputQuantity.value);
            
            const currentStock = getCurrentStock();
            
            // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ù‡∏±‡πà‡∏á Client ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á
            if (quantity <= 0) {
                 showErrorPopup('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç<br>‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0');
                 return;
            } 
            
            if (quantity > currentStock) {
                 showErrorPopup(`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å <b>(${quantity} ‡πÅ‡∏ú‡πà‡∏ô)</b><br>
                    ‡∏°‡∏µ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ <b>(${currentStock} ‡πÅ‡∏ú‡πà‡∏ô)</b>`);
                 return;
            }
            
            // 2. ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ GAS
            submitButton.disabled = true;
            submitButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
            formMessage.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';

            const orderData = {
                type: selectedTypeVal,
                thickness: selectedThicknessVal,
                size: selectedSizeVal,
                quantity: quantity
            };

            try {
                // *** ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ***
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    // mode: 'no-cors', // <--- *** ‡∏•‡∏ö‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏ó‡∏¥‡πâ‡∏á ***
                    cache: 'no-cache',
                    redirect: 'follow',
                    body: JSON.stringify(orderData)
                });

                // *** ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ***
                // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏£‡∏≠‡∏≠‡πà‡∏≤‡∏ô JSON ‡∏ó‡∏µ‡πà GAS ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
                const result = await response.json();

                // 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
                if (result.status === 'success') {
                    
                    // 3a. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ 'sheetData' (‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö)
                    const foundItem = sheetData.find(item => 
                        item.type === selectedTypeVal && 
                        String(item.thickness) === selectedThicknessVal &&
                        item.size === selectedSizeVal
                    );
                    
                    if (foundItem) {
                        // ‡πÉ‡∏ä‡πâ newStock ‡∏ó‡∏µ‡πà‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ (result.newStock) ‡∏à‡∏∞‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏Å‡∏ß‡πà‡∏≤
                        foundItem.stock = result.newStock; 
                    }

                    // 3b. ‡πÅ‡∏™‡∏î‡∏á Popup ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    const detailsHtml = `
                        <b>‡∏ä‡∏ô‡∏¥‡∏î:</b> ${selectedTypeText}<br>
                        <b>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤:</b> ${selectedThicknessText}<br>
                        <b>‡∏Ç‡∏ô‡∏≤‡∏î:</b> ${selectedSizeText}<br>
                        <b>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</b> ${quantity} ‡πÅ‡∏ú‡πà‡∏ô<br>
                        <hr style="border:0; border-top:1px solid #eee; margin: 8px 0;">
                        <b>‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${result.newStock} ‡πÅ‡∏ú‡πà‡∏ô</b>
                    `;
                    popupDetails.innerHTML = detailsHtml;
                    successPopup.classList.add('active'); // <--- ‡πÅ‡∏™‡∏î‡∏á Popup ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

                    // 3c. ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏î‡∏µ‡πÄ‡∏•‡∏¢‡πå
                    setTimeout(function() {
                        successPopup.classList.remove('active');
                        glassForm.reset();
                        resetDropdown(selectThickness, '-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏£‡∏∞‡∏à‡∏Å‡∏Å‡πà‡∏≠‡∏ô --');
                        resetDropdown(selectSize, '-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏Å‡πà‡∏≠‡∏ô --');
                        resetStockInfo();
                        populateTypeDropdown(); 
                        selectType.value = "";
                    }, 1500);

                } else {
                    // 4. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏™‡πà‡∏á "error" ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
                    // ‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏≠ (‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πá‡∏Å‡πÉ‡∏ô GAS)
                    throw new Error(result.message);
                }

            } catch (error) {
                // 5. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î Network ‡∏´‡∏£‡∏∑‡∏≠ Error ‡∏à‡∏≤‡∏Å GAS
                console.error('Error submitting form:', error);
                // ‡πÅ‡∏™‡∏î‡∏á Error ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á (‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏°‡∏≤‡∏à‡∏≤‡∏Å 'throw new Error(result.message)' ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)
                showErrorPopup(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: <br>${error.message}`);
            
            } finally {
                // 6. ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°
                submitButton.disabled = false;
                submitButton.textContent = '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                formMessage.textContent = '(‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á)';
            }
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏™‡∏î‡∏á Error Popup
        function showErrorPopup(message) {
            errorDetails.innerHTML = message;
            errorPopup.classList.add('active');
            setTimeout(() => {
                errorPopup.classList.remove('active');
            }, 1500);
        }

    </script>

</body>
</html>